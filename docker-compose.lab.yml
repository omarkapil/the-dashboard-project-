version: '3.8'

services:
  # 1. Network Gateway / Router
  lab_gateway:
    image: alpine:latest
    container_name: lab_gateway
    command: sh -c "apk add --no-cache netcat-openbsd && /entrypoint.sh"
    volumes:
      - ./lab_config/entrypoint.sh:/entrypoint.sh
    environment:
      - SIMULATE_OS=router
    networks:
      - lab_network
    cap_add:
      - NET_ADMIN

  # 2. Corporate Database (Vulnerable Redis)
  lab_db:
    image: redis:6.0
    container_name: lab_db
    ports:
      - "6379"
    networks:
      - lab_network

  # 3. File Server (Vulnerable SMB)
  lab_files:
    image: dperson/samba
    container_name: lab_files
    environment:
      - USER=admin;admin
      - SHARE=public;/public;yes;no;no;all;none;
    networks:
      - lab_network

  # 4. HR Workstation (Simulated Windows)
  lab_hr_pc:
    image: alpine:latest
    container_name: lab_hr_pc
    command: sh -c "apk add --no-cache netcat-openbsd && chmod +x /entrypoint.sh && /entrypoint.sh"
    volumes:
      - ./lab_config/entrypoint.sh:/entrypoint.sh
    environment:
      - SIMULATE_OS=windows
    networks:
      - lab_network

  # 5. Developer Laptop (Linux)
  lab_dev_pc:
    image: nginx:alpine
    container_name: lab_dev_pc
    command: sh -c "apk add --no-cache netcat-openbsd && chmod +x /entrypoint.sh && /entrypoint.sh"
    volumes:
      - ./lab_config/entrypoint.sh:/entrypoint.sh
    environment:
      - SIMULATE_OS=linux
    networks:
      - lab_network

networks:
  lab_network:
    driver: bridge
